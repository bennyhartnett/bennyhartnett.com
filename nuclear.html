<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uranium Enrichment Calculators – Tailwind</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>

  <!-- SweetAlert2 for error messages -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Dark mode initialization (prevent flash) -->
  <script>
    if (localStorage.getItem('darkMode') === 'true' ||
        (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    }
  </script>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-400 to-teal-500 dark:from-slate-900 dark:to-slate-800 px-4 py-8 text-slate-900 dark:text-slate-100 transition-colors duration-300">

  <main class="relative mx-auto w-full max-w-4xl rounded-2xl bg-white/95 dark:bg-slate-800/95 p-6 shadow-xl ring-1 ring-slate-200 dark:ring-slate-700 transition-colors duration-300">
    <!-- Header -->
    <header class="mb-6 flex flex-col items-center gap-3">
      <!-- Home link -->
      <a
        href="/"
        class="absolute top-4 left-4 sm:top-6 sm:left-6 p-2 rounded-full bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors"
        aria-label="Go to home page"
      >
        <svg class="h-5 w-5 text-slate-700 dark:text-slate-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" />
          <path d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z" />
        </svg>
      </a>

      <!-- Dark mode toggle -->
      <button
        id="darkModeToggle"
        type="button"
        class="absolute top-4 right-4 sm:top-6 sm:right-6 p-2 rounded-full bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors"
        aria-label="Toggle dark mode"
      >
        <!-- Sun icon (shown in dark mode) -->
        <svg class="hidden dark:block h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
        </svg>
        <!-- Moon icon (shown in light mode) -->
        <svg class="block dark:hidden h-5 w-5 text-slate-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd" />
        </svg>
      </button>
      <img
        src="CENTRUS_LOGO.PNG"
        alt="Centrus Energy logo"
        class="h-16 w-auto object-contain dark:brightness-110"
      />
      <div class="text-center">
        <h1 class="text-3xl font-bold tracking-tight">Uranium Enrichment Calculators</h1>
        <p class="mt-1 max-w-xl text-sm text-slate-600 dark:text-slate-400">
          Lightweight browser-based tools for common uranium enrichment scenarios:
          feed requirements, SWU demand, and optimum tails assay.
        </p>
      </div>
    </header>

    <!-- Mode navigation -->
    <nav class="mb-6 flex flex-wrap justify-center gap-2 text-xs sm:text-sm">
      <a href="#mode1" class="rounded-full bg-slate-100 dark:bg-slate-700 px-3 py-1 font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
        1. Feed &amp; SWU for 1&nbsp;kg U EUP
      </a>
      <a href="#mode2" class="rounded-full bg-slate-100 dark:bg-slate-700 px-3 py-1 font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
        2. Feed &amp; SWU from EUP
      </a>
      <a href="#mode3" class="rounded-full bg-slate-100 dark:bg-slate-700 px-3 py-1 font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
        3. EUP &amp; SWU from Feed
      </a>
      <a href="#mode4" class="rounded-full bg-slate-100 dark:bg-slate-700 px-3 py-1 font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
        4. Feed &amp; EUP from SWU
      </a>
      <a href="#mode5" class="rounded-full bg-slate-100 dark:bg-slate-700 px-3 py-1 font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
        5. Optimum Tails Assay
      </a>
    </nav>

    <!-- Calculator 1 -->
    <section id="mode1" class="mb-5">
      <details class="group rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 shadow-sm" open>
        <summary
          class="flex cursor-pointer items-center justify-between gap-3 rounded-t-xl border-b border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 px-4 py-3 text-sm font-semibold text-slate-800 dark:text-slate-200 transition-colors group-open:bg-slate-100 dark:group-open:bg-slate-600"
        >
          <span>Feed &amp; SWU for 1&nbsp;kg U EUP</span>
          <svg
            class="h-4 w-4 shrink-0 text-slate-500 dark:text-slate-400 transition-transform group-open:rotate-180"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </summary>

        <div class="space-y-6 bg-slate-50 dark:bg-slate-700 px-4 py-5 rounded-b-xl">
          <form id="form1" class="space-y-6">
            <!-- Inputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Inputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0">
                <!-- Product assay -->
                <div>
                  <label for="xp1" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Product Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xp1"
                      type="number"
                      step="any"
                      placeholder="5"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Percent of U-235 in the product stream.
                  </p>
                </div>

                <!-- Tails assay -->
                <div>
                  <label for="xw1" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Tails Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xw1"
                      type="number"
                      step="any"
                      placeholder="0.3"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Percent of U-235 in the waste stream.
                  </p>
                </div>

                <!-- Feed assay -->
                <div>
                  <label for="xf1" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xf1"
                      type="number"
                      step="any"
                      placeholder="0.7"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Percent of U-235 in the feed.
                  </p>
                </div>
              </div>
            </section>

            <!-- Outputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Outputs (for 1&nbsp;kg U in product)</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- Feed quantity -->
                <div>
                  <label for="feed1" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="feed1"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg UF₆
                    </span>
                  </div>
                </div>

                <!-- SWU quantity -->
                <div>
                  <label for="swu1" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    SWU Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="swu1"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      SWU
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Actions -->
            <div class="flex flex-col gap-3 pt-2 sm:flex-row">
              <button
                id="clear1"
                type="button"
                class="w-full rounded-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 transition hover:bg-slate-200 dark:hover:bg-slate-500"
              >
                Clear
              </button>
              <button
                id="calc1"
                type="button"
                class="w-full rounded-md bg-blue-600 dark:bg-blue-500 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:focus:ring-offset-slate-700"
              >
                Calculate
              </button>
            </div>
          </form>
        </div>
      </details>
    </section>

    <!-- Calculator 2 -->
    <section id="mode2" class="mb-5">
      <details class="group rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 shadow-sm">
        <summary
          class="flex cursor-pointer items-center justify-between gap-3 rounded-t-xl border-b border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 px-4 py-3 text-sm font-semibold text-slate-800 dark:text-slate-200 transition-colors group-open:bg-slate-100 dark:group-open:bg-slate-600"
        >
          <span>Feed &amp; SWU from EUP Quantity</span>
          <svg
            class="h-4 w-4 shrink-0 text-slate-500 dark:text-slate-400 transition-transform group-open:rotate-180"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </summary>

        <div class="space-y-6 bg-slate-50 dark:bg-slate-700 px-4 py-5 rounded-b-xl">
          <form id="form2" class="space-y-6">
            <!-- Inputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Inputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- EUP quantity -->
                <div>
                  <label for="p2" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    EUP Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="p2"
                      type="number"
                      step="any"
                      placeholder="100"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg UF₆
                    </span>
                  </div>
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Mass of enriched uranium product.
                  </p>
                </div>

                <!-- Product assay -->
                <div>
                  <label for="xp2" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Product Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xp2"
                      type="number"
                      step="any"
                      placeholder="5"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Tails assay -->
                <div>
                  <label for="xw2" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Tails Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xw2"
                      type="number"
                      step="any"
                      placeholder="0.3"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Feed assay -->
                <div>
                  <label for="xf2" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xf2"
                      type="number"
                      step="any"
                      placeholder="0.7"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Outputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Outputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- Feed quantity -->
                <div>
                  <label for="feed2" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="feed2"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg UF₆
                    </span>
                  </div>
                </div>

                <!-- SWU quantity -->
                <div>
                  <label for="swu2" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    SWU Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="swu2"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      SWU
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Actions -->
            <div class="flex flex-col gap-3 pt-2 sm:flex-row">
              <button
                id="clear2"
                type="button"
                class="w-full rounded-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 transition hover:bg-slate-200 dark:hover:bg-slate-500"
              >
                Clear
              </button>
              <button
                id="calc2"
                type="button"
                class="w-full rounded-md bg-blue-600 dark:bg-blue-500 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:focus:ring-offset-slate-700"
              >
                Calculate
              </button>
            </div>
          </form>
        </div>
      </details>
    </section>

    <!-- Calculator 3 -->
    <section id="mode3" class="mb-5">
      <details class="group rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 shadow-sm">
        <summary
          class="flex cursor-pointer items-center justify-between gap-3 rounded-t-xl border-b border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 px-4 py-3 text-sm font-semibold text-slate-800 dark:text-slate-200 transition-colors group-open:bg-slate-100 dark:group-open:bg-slate-600"
        >
          <span>EUP &amp; SWU from Feed Quantity</span>
          <svg
            class="h-4 w-4 shrink-0 text-slate-500 dark:text-slate-400 transition-transform group-open:rotate-180"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </summary>

        <div class="space-y-6 bg-slate-50 dark:bg-slate-700 px-4 py-5 rounded-b-xl">
          <form id="form3" class="space-y-6">
            <!-- Inputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Inputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- Feed quantity -->
                <div>
                  <label for="F3" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="F3"
                      type="number"
                      step="any"
                      placeholder="100"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg UF₆
                    </span>
                  </div>
                </div>

                <!-- Product assay -->
                <div>
                  <label for="xp3" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Product Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xp3"
                      type="number"
                      step="any"
                      placeholder="5"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Tails assay -->
                <div>
                  <label for="xw3" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Tails Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xw3"
                      type="number"
                      step="any"
                      placeholder="0.3"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Feed assay -->
                <div>
                  <label for="xf3" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xf3"
                      type="number"
                      step="any"
                      placeholder="0.7"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Outputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Outputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- EUP quantity -->
                <div>
                  <label for="P3" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    EUP Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="P3"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg UF₆
                    </span>
                  </div>
                </div>

                <!-- SWU quantity -->
                <div>
                  <label for="swu3" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    SWU Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="swu3"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      SWU
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Actions -->
            <div class="flex flex-col gap-3 pt-2 sm:flex-row">
              <button
                id="clear3"
                type="button"
                class="w-full rounded-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 transition hover:bg-slate-200 dark:hover:bg-slate-500"
              >
                Clear
              </button>
              <button
                id="calc3"
                type="button"
                class="w-full rounded-md bg-blue-600 dark:bg-blue-500 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:focus:ring-offset-slate-700"
              >
                Calculate
              </button>
            </div>
          </form>
        </div>
      </details>
    </section>

    <!-- Calculator 4 -->
    <section id="mode4" class="mb-5">
      <details class="group rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 shadow-sm">
        <summary
          class="flex cursor-pointer items-center justify-between gap-3 rounded-t-xl border-b border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 px-4 py-3 text-sm font-semibold text-slate-800 dark:text-slate-200 transition-colors group-open:bg-slate-100 dark:group-open:bg-slate-600"
        >
          <span>Feed &amp; EUP from SWU Quantity</span>
          <svg
            class="h-4 w-4 shrink-0 text-slate-500 dark:text-slate-400 transition-transform group-open:rotate-180"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </summary>

        <div class="space-y-6 bg-slate-50 dark:bg-slate-700 px-4 py-5 rounded-b-xl">
          <form id="form4" class="space-y-6">
            <!-- Inputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Inputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- SWU quantity -->
                <div>
                  <label for="S4" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    SWU Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="S4"
                      type="number"
                      step="any"
                      placeholder="500"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      SWU
                    </span>
                  </div>
                </div>

                <!-- Product assay -->
                <div>
                  <label for="xp4" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Product Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xp4"
                      type="number"
                      step="any"
                      placeholder="5"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Tails assay -->
                <div>
                  <label for="xw4" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Tails Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xw4"
                      type="number"
                      step="any"
                      placeholder="0.3"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Feed assay -->
                <div>
                  <label for="xf4" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xf4"
                      type="number"
                      step="any"
                      placeholder="0.7"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Outputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Outputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- EUP quantity -->
                <div>
                  <label for="P4" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    EUP Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="P4"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg U
                    </span>
                  </div>
                </div>

                <!-- Feed quantity -->
                <div>
                  <label for="feed4" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Quantity
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="feed4"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      kg UF₆
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Actions -->
            <div class="flex flex-col gap-3 pt-2 sm:flex-row">
              <button
                id="clear4"
                type="button"
                class="w-full rounded-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 transition hover:bg-slate-200 dark:hover:bg-slate-500"
              >
                Clear
              </button>
              <button
                id="calc4"
                type="button"
                class="w-full rounded-md bg-blue-600 dark:bg-blue-500 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:focus:ring-offset-slate-700"
              >
                Calculate
              </button>
            </div>
          </form>
        </div>
      </details>
    </section>

    <!-- Calculator 5 -->
    <section id="mode5">
      <details class="group rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 shadow-sm">
        <summary
          class="flex cursor-pointer items-center justify-between gap-3 rounded-t-xl border-b border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 px-4 py-3 text-sm font-semibold text-slate-800 dark:text-slate-200 transition-colors group-open:bg-slate-100 dark:group-open:bg-slate-600"
        >
          <span>Optimum Tails Assay</span>
          <svg
            class="h-4 w-4 shrink-0 text-slate-500 dark:text-slate-400 transition-transform group-open:rotate-180"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </summary>

        <div class="space-y-6 bg-slate-50 dark:bg-slate-700 px-4 py-5 rounded-b-xl">
          <form id="form5" class="space-y-6">
            <!-- Inputs -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Inputs</h2>

              <div class="space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0">
                <!-- Feed price -->
                <div>
                  <label for="cf5" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Price
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="cf5"
                      type="number"
                      step="any"
                      placeholder="75"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      currency / kg
                    </span>
                  </div>
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Cost of feed per kilogram of uranium.
                  </p>
                </div>

                <!-- SWU price -->
                <div>
                  <label for="cs5" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    SWU Price
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="cs5"
                      type="number"
                      step="any"
                      placeholder="100"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      currency / SWU
                    </span>
                  </div>
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Cost of enrichment work per SWU.
                  </p>
                </div>

                <!-- Product assay -->
                <div>
                  <label for="xp5" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Product Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xp5"
                      type="number"
                      step="any"
                      placeholder="5"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>

                <!-- Feed assay -->
                <div>
                  <label for="xf5" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Feed Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xf5"
                      type="number"
                      step="any"
                      placeholder="0.7"
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Output -->
            <section>
              <h2 class="mb-3 text-base font-semibold text-slate-900 dark:text-slate-100">Output</h2>

              <div class="space-y-4 sm:w-1/2">
                <div>
                  <label for="xw5" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Optimum Tails Assay
                  </label>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      id="xw5"
                      type="text"
                      readonly
                      class="block w-full flex-1 rounded-l-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-200 focus:outline-none"
                    />
                    <span
                      class="inline-flex items-center rounded-r-md border border-l-0 border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-500 px-3 text-xs font-medium text-slate-600 dark:text-slate-200"
                    >
                      % U-235
                    </span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Actions -->
            <div class="flex flex-col gap-3 pt-2 sm:flex-row">
              <button
                id="clear5"
                type="button"
                class="w-full rounded-md border border-slate-300 dark:border-slate-500 bg-slate-100 dark:bg-slate-600 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 transition hover:bg-slate-200 dark:hover:bg-slate-500"
              >
                Clear
              </button>
              <button
                id="calc5"
                type="button"
                class="w-full rounded-md bg-blue-600 dark:bg-blue-500 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:focus:ring-offset-slate-700"
              >
                Calculate
              </button>
            </div>
          </form>
        </div>
      </details>
    </section>

    <!-- Footer -->
    <footer class="mt-6 border-t border-slate-200 dark:border-slate-600 pt-3 text-center text-xs text-slate-500 dark:text-slate-400">
      <div>© <span id="current-year"></span> bennyhartnett.com</div>
    </footer>
  </main>

  <!-- Calculator logic -->
  <script>
    (function () {
      const EPS = 1e-9;

      const byId = (id) => document.getElementById(id);

      function showError(message) {
        Swal.fire({
          icon: "error",
          title: "Invalid input",
          text: message,
        });
      }

      function parseAssay(id) {
        const raw = byId(id).value.trim();
        const value = parseFloat(raw);
        if (!isFinite(value)) {
          throw new Error("Assay must be a number.");
        }
        if (value <= 0 || value >= 100) {
          throw new Error("Assay must be between 0 and 100 (exclusive).");
        }
        return value / 100;
      }

      function parseMass(id) {
        const raw = byId(id).value.trim();
        const value = parseFloat(raw);
        if (!isFinite(value) || value <= 0) {
          throw new Error("Mass values must be positive numbers.");
        }
        return value;
      }

      function parsePositiveNumber(id) {
        const raw = byId(id).value.trim();
        const value = parseFloat(raw);
        if (!isFinite(value) || value <= 0) {
          throw new Error("Values must be positive numbers.");
        }
        return value;
      }

      function valueFunction(x) {
        const xx = Math.min(Math.max(x, EPS), 1 - EPS);
        return (1 - 2 * xx) * Math.log((1 - xx) / xx);
      }

      function checkOrdering(xp, xf, xw) {
        if (!(xp > xf && xf > xw)) {
          throw new Error("Assays must satisfy: product > feed > tails.");
        }
      }

      function massBalance(P, xp, xf, xw) {
        checkOrdering(xp, xf, xw);
        const F = ((xp - xw) / (xf - xw)) * P;
        const W = F - P;
        if (F <= 0 || W <= 0) {
          throw new Error("Computed masses must be positive.");
        }
        return { F, W };
      }

      function swuFor(P, xp, xf, xw) {
        const { F, W } = massBalance(P, xp, xf, xw);
        const swu =
          P * valueFunction(xp) + W * valueFunction(xw) - F * valueFunction(xf);
        if (swu <= 0) {
          throw new Error("Computed SWU must be positive.");
        }
        return { F, W, swu };
      }

      function computeFeedSwuForOneKg(xp, xw, xf) {
        return swuFor(1, xp, xf, xw);
      }

      function computeFeedSwu(xp, xw, xf, P) {
        return swuFor(P, xp, xf, xw);
      }

      function computeEupSwu(xp, xw, xf, F) {
        checkOrdering(xp, xf, xw);
        const P = ((xf - xw) / (xp - xw)) * F;
        if (P <= 0) {
          throw new Error("Computed product mass must be positive.");
        }
        const W = F - P;
        const swu =
          P * valueFunction(xp) + W * valueFunction(xw) - F * valueFunction(xf);
        if (swu <= 0) {
          throw new Error("Computed SWU must be positive.");
        }
        return { P, W, swu };
      }

      function computeFeedEupFromSwu(xp, xw, xf, S) {
        checkOrdering(xp, xf, xw);
        if (S <= 0) throw new Error("SWU must be positive.");

        let Plo = EPS;
        let Phi = 1;

        while (true) {
          const { swu } = swuFor(Phi, xp, xf, xw);
          if (swu > S) break;
          Phi *= 2;
          if (Phi > 1e7) {
            throw new Error("SWU too large or parameters unrealistic.");
          }
        }

        for (let i = 0; i < 80; i++) {
          const Pmid = 0.5 * (Plo + Phi);
          const { swu } = swuFor(Pmid, xp, xf, xw);
          if (Math.abs(swu - S) / S < 1e-6) {
            Plo = Phi = Pmid;
            break;
          }
          if (swu > S) {
            Phi = Pmid;
          } else {
            Plo = Pmid;
          }
        }

        const P = 0.5 * (Plo + Phi);
        const { F } = massBalance(P, xp, xf, xw);
        return { P, F };
      }

      function findOptimumTails(xp, xf, cf, cs) {
        checkOrdering(xp, xf, xf / 2); // loose check to ensure xp>xf

        const a = Math.max(EPS, xf * 0.01);
        const b = Math.max(a + EPS, xf - EPS);

        function costPerKg(xw) {
          const { F, W, swu } = swuFor(1, xp, xf, xw);
          return cf * F + cs * swu;
        }

        let left = a;
        let right = b;
        const phi = (1 + Math.sqrt(5)) / 2;
        let x1 = right - (right - left) / phi;
        let x2 = left + (right - left) / phi;
        let f1 = costPerKg(x1);
        let f2 = costPerKg(x2);

        for (let i = 0; i < 80; i++) {
          if (f1 > f2) {
            left = x1;
            x1 = x2;
            f1 = f2;
            x2 = left + (right - left) / phi;
            f2 = costPerKg(x2);
          } else {
            right = x2;
            x2 = x1;
            f2 = f1;
            x1 = right - (right - left) / phi;
            f1 = costPerKg(x1);
          }
        }

        const xwOpt = 0.5 * (left + right);
        const { F, W, swu } = swuFor(1, xp, xf, xwOpt);
        const cost = costPerKg(xwOpt);
        return { xw: xwOpt, F_per_P: F, swu_per_P: swu, cost_per_P: cost };
      }

      function resetForm(formId) {
        const form = byId(formId);
        if (!form) return;
        form.reset();
        form.querySelectorAll("input").forEach((input) => {
          if (input.hasAttribute("readonly")) {
            input.value = "";
          }
        });
      }

      function setupHandlers() {
        // Mode 1
        byId("calc1").addEventListener("click", () => {
          try {
            const xp = parseAssay("xp1");
            const xw = parseAssay("xw1");
            const xf = parseAssay("xf1");
            const res = computeFeedSwuForOneKg(xp, xw, xf);
            byId("feed1").value = res.F.toFixed(6);
            byId("swu1").value = res.swu.toFixed(3);
          } catch (err) {
            showError(err.message);
          }
        });
        byId("clear1").addEventListener("click", () => resetForm("form1"));

        // Mode 2
        byId("calc2").addEventListener("click", () => {
          try {
            const P = parseMass("p2");
            const xp = parseAssay("xp2");
            const xw = parseAssay("xw2");
            const xf = parseAssay("xf2");
            const res = computeFeedSwu(xp, xw, xf, P);
            byId("feed2").value = res.F.toFixed(6);
            byId("swu2").value = res.swu.toFixed(3);
          } catch (err) {
            showError(err.message);
          }
        });
        byId("clear2").addEventListener("click", () => resetForm("form2"));

        // Mode 3
        byId("calc3").addEventListener("click", () => {
          try {
            const F = parseMass("F3");
            const xp = parseAssay("xp3");
            const xw = parseAssay("xw3");
            const xf = parseAssay("xf3");
            const res = computeEupSwu(xp, xw, xf, F);
            byId("P3").value = res.P.toFixed(6);
            byId("swu3").value = res.swu.toFixed(3);
          } catch (err) {
            showError(err.message);
          }
        });
        byId("clear3").addEventListener("click", () => resetForm("form3"));

        // Mode 4
        byId("calc4").addEventListener("click", () => {
          try {
            const S = parsePositiveNumber("S4");
            const xp = parseAssay("xp4");
            const xw = parseAssay("xw4");
            const xf = parseAssay("xf4");
            const res = computeFeedEupFromSwu(xp, xw, xf, S);
            byId("P4").value = res.P.toFixed(6);
            byId("feed4").value = res.F.toFixed(6);
          } catch (err) {
            showError(err.message);
          }
        });
        byId("clear4").addEventListener("click", () => resetForm("form4"));

        // Mode 5
        byId("calc5").addEventListener("click", () => {
          try {
            const cf = parsePositiveNumber("cf5");
            const cs = parsePositiveNumber("cs5");
            const xp = parseAssay("xp5");
            const xf = parseAssay("xf5");
            const res = findOptimumTails(xp, xf, cf, cs);
            byId("xw5").value = (res.xw * 100).toFixed(3);
          } catch (err) {
            showError(err.message);
          }
        });
        byId("clear5").addEventListener("click", () => resetForm("form5"));

        const yearEl = document.getElementById("current-year");
        if (yearEl) yearEl.textContent = new Date().getFullYear();

        // Dark mode toggle
        const darkModeToggle = document.getElementById("darkModeToggle");
        if (darkModeToggle) {
          darkModeToggle.addEventListener("click", () => {
            const html = document.documentElement;
            const isDark = html.classList.toggle("dark");
            localStorage.setItem("darkMode", isDark);
          });
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", setupHandlers);
      } else {
        // Use setTimeout to defer execution, ensuring DOM is ready after SPA navigation
        setTimeout(setupHandlers, 0);
      }
    })();
  </script>
</body>
</html>
